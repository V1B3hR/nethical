policies:
  - name: "healthcare_core"
    version: "0.2"
    enabled: true
    description: "Region-aware healthcare safety/ethics policy pack with hooks for defense-medical"
    tags: ["healthcare", "safety", "ethics"]

    rules:
      - condition: "(content.signals.contains_medical_diagnosis == True or content.signals.suggests_treatment_plan == True) and not (context.roles.contains_clinician == True and governance.hil_approved == True)"
        severity: HIGH
        description: "Prevent definitive diagnoses without human review or validated protocol"
        actions:
          - restrict_output
          - require_hil_review
          - add_disclaimer
          - audit_log
        metadata:
          action_params:
            add_disclaimer: "Information provided is educational and not a substitute for professional medical advice."
          risk: "high"
          legacy_id: "hc.no_unqualified_diagnosis"

      - condition: "(manipulation.prompt_injection.score >= 0.7) or (manipulation.override_attempt == True) or (manipulation.data_exfil_pattern == True)"
        severity: CRITICAL
        description: "Block attempts to override safety/policy, data exfiltration, or tool abuse"
        actions:
          - block_action
          - quarantine_recommended
          - audit_log
        metadata:
          risk: "critical"
          legacy_id: "hc.prompt_injection_block"

      - condition: "(security.phi_detected_outbound == True) or (security.phi_detected_in_logs == True)"
        severity: HIGH
        description: "Mask or redact PHI before model output and logs"
        actions:
          - redact_phi
          - restrict_output
          - audit_log
        metadata:
          risk: "high"
          legacy_id: "hc.phi_leakage_prevention"

      - condition: "(clinical.medication_mentioned == True) and (clinical.condition_mentioned == True) and (clinical.contraindication_possible == True)"
        severity: HIGH
        description: "Flag potential contraindications for human review"
        actions:
          - restrict_output
          - require_hil_review
          - audit_log
        metadata:
          risk: "high"
          legacy_id: "hc.contraindication_flag"

      - condition: "safety.emergency_intent in ['self_harm','overdose','acute_distress']"
        severity: CRITICAL
        description: "Escalate if self-harm/overdose/acute distress intent detected"
        actions:
          - terminate_interaction
          - escalate_to_emergency
          - add_disclaimer
        metadata:
          action_params:
            add_disclaimer: "If this is an emergency, use the appropriate local emergency number."
          risk: "critical"
          legacy_id: "hc.emergency_intent_escalation"

      - condition: "clinical.high_risk_medication == True"
        severity: CRITICAL
        description: "Escalate for high-risk medication queries"
        actions:
          - escalate
          - add_disclaimer
          - audit_log
        metadata:
          action_params:
            add_disclaimer: "Information provided is educational and not a substitute for professional medical advice."
          priority: "CRITICAL"
          legacy_group: "routing.high_risk_medication"

      - condition: "clinical.ambiguous_symptoms == True"
        severity: HIGH
        description: "Escalate for ambiguous symptoms"
        actions:
          - escalate
          - add_disclaimer
          - audit_log
        metadata:
          action_params:
            add_disclaimer: "Information provided is educational and not a substitute for professional medical advice."
          priority: "HIGH"
          legacy_group: "routing.ambiguous_symptoms"

  - name: "healthcare_region_overlays"
    version: "0.2"
    enabled: true
    description: "Region-specific emergency disclaimer overlays"
    tags: ["healthcare", "region", "disclaimer"]

    rules:
      - condition: "safety.emergency_intent is not None and context.region == 'UK'"
        severity: CRITICAL
        description: "UK emergency routing"
        actions:
          - add_disclaimer
        metadata:
          action_params:
            add_disclaimer: "If this is urgent, call 999 (UK) or go to A&E."
          legacy_region: "UK"

      - condition: "safety.emergency_intent is not None and context.region == 'US'"
        severity: CRITICAL
        description: "US emergency routing"
        actions:
          - add_disclaimer
        metadata:
          action_params:
            add_disclaimer: "If this is an emergency, call 911 (US)."
          legacy_region: "US"

      - condition: "safety.emergency_intent is not None and context.region == 'EU'"
        severity: CRITICAL
        description: "EU emergency routing"
        actions:
          - add_disclaimer
        metadata:
          action_params:
            add_disclaimer: "If this is an emergency, call 112 (EU)."
          legacy_region: "EU"

      - condition: "safety.emergency_intent is not None and context.region == 'NATO'"
        severity: CRITICAL
        description: "NATO/emergency routing (use local number)"
        actions:
          - add_disclaimer
        metadata:
          action_params:
            add_disclaimer: "If this is an emergency, use local emergency number."
          legacy_region: "NATO"

      - condition: "content.topic == 'health' and not safety.emergency_intent"
        severity: INFO
        description: "Add general non-diagnostic disclaimer for health info"
        actions:
          - add_disclaimer
        metadata:
          action_params:
            add_disclaimer: "Information provided is educational and not a substitute for professional medical advice."

  - name: "defense_medical_hooks"
    version: "0.2"
    enabled: false
    description: "Optional defense-medical attestation/crypto signaling hooks"
    tags: ["defense", "attestation", "experimental"]

    rules:
      - condition: "defense.crypto_signaling_required == True"
        severity: HIGH
        description: "Require cryptographic signaling before sensitive operations"
        actions:
          - require_crypto_signal
          - audit_log

      - condition: "defense.attestation_required == True"
        severity: HIGH
        description: "Require platform attestation before enabling medical tools"
        actions:
          - require_attestation
          - audit_log
