---
# NIST 800-53 Rev. 5 Security Controls Configuration
apiVersion: v1
kind: ConfigMap
metadata:
  name: nethical-nist-controls-config
  namespace: nethical
  labels:
    app.kubernetes.io/name: nethical
    compliance.nethical.io/framework: nist-800-53
data:
  nist-controls.yaml: |
    version: "1.0"
    compliance_framework: "NIST_800_53_Rev5"
    impact_level: "moderate"  # low, moderate, high
    
    # Access Control (AC) Family
    access_control:
      AC-1:  # Policy and Procedures
        name: "Access Control Policy and Procedures"
        implementation: "Documented in governance policies"
        status: "implemented"
      AC-2:  # Account Management
        name: "Account Management"
        implementation: "RBAC with automated provisioning"
        status: "implemented"
        controls:
          - automatic_account_creation: true
          - account_review_frequency: "quarterly"
          - account_termination: "immediate"
      AC-3:  # Access Enforcement
        name: "Access Enforcement"
        implementation: "Policy engine with RBAC"
        status: "implemented"
      AC-6:  # Least Privilege
        name: "Least Privilege"
        implementation: "Role-based access with minimum permissions"
        status: "implemented"
      AC-7:  # Unsuccessful Logon Attempts
        name: "Unsuccessful Logon Attempts"
        implementation: "Account lockout after 3 attempts"
        status: "implemented"
        lockout_threshold: 3
        lockout_duration_seconds: 1800  # 30 minutes
      AC-8:  # System Use Notification
        name: "System Use Notification"
        implementation: "Login banner"
        status: "implemented"
      AC-11:  # Session Lock
        name: "Session Lock"
        implementation: "Automatic timeout after 15 minutes"
        status: "implemented"
        timeout_seconds: 900  # 15 minutes
      AC-17:  # Remote Access
        name: "Remote Access"
        implementation: "TLS 1.3 with MFA"
        status: "implemented"
        
    # Audit and Accountability (AU) Family
    audit_accountability:
      AU-2:  # Audit Events
        name: "Audit Events"
        implementation: "Comprehensive event logging"
        status: "implemented"
        events:
          - successful_login
          - failed_login
          - privilege_elevation
          - data_access
          - data_modification
          - policy_changes
          - security_events
      AU-3:  # Content of Audit Records
        name: "Content of Audit Records"
        implementation: "Structured logging with required fields"
        status: "implemented"
        fields:
          - timestamp
          - user_identity
          - event_type
          - outcome
          - source_address
          - resource_accessed
      AU-6:  # Audit Review
        name: "Audit Review, Analysis, and Reporting"
        implementation: "Automated analysis with alerting"
        status: "implemented"
      AU-9:  # Protection of Audit Information
        name: "Protection of Audit Information"
        implementation: "Merkle tree anchoring, immutable storage"
        status: "implemented"
      AU-11:  # Audit Record Retention
        name: "Audit Record Retention"
        implementation: "7 year retention"
        status: "implemented"
        retention_years: 7
        
    # Configuration Management (CM) Family
    configuration_management:
      CM-2:  # Baseline Configuration
        name: "Baseline Configuration"
        implementation: "Infrastructure as Code"
        status: "implemented"
      CM-6:  # Configuration Settings
        name: "Configuration Settings"
        implementation: "Hardened container configuration"
        status: "implemented"
      CM-7:  # Least Functionality
        name: "Least Functionality"
        implementation: "Minimal container images"
        status: "implemented"
      CM-8:  # System Component Inventory
        name: "System Component Inventory"
        implementation: "SBOM generation"
        status: "implemented"
        
    # Identification and Authentication (IA) Family
    identification_authentication:
      IA-2:  # Identification and Authentication
        name: "Identification and Authentication"
        implementation: "Multi-factor authentication"
        status: "implemented"
        mfa_required: true
      IA-5:  # Authenticator Management
        name: "Authenticator Management"
        implementation: "Password policy, key rotation"
        status: "implemented"
        password_complexity: high
        password_expiration_days: 90
        key_rotation_days: 90
        
    # System and Communications Protection (SC) Family
    system_communications:
      SC-8:  # Transmission Confidentiality
        name: "Transmission Confidentiality and Integrity"
        implementation: "TLS 1.3 for all communications"
        status: "implemented"
      SC-12:  # Cryptographic Key Establishment
        name: "Cryptographic Key Establishment and Management"
        implementation: "HSM-backed key management"
        status: "implemented"
      SC-13:  # Cryptographic Protection
        name: "Cryptographic Protection"
        implementation: "FIPS 140-3 validated modules"
        status: "implemented"
      SC-28:  # Protection of Information at Rest
        name: "Protection of Information at Rest"
        implementation: "AES-256-GCM encryption"
        status: "implemented"
        
    # System and Information Integrity (SI) Family
    system_integrity:
      SI-2:  # Flaw Remediation
        name: "Flaw Remediation"
        implementation: "Automated vulnerability scanning"
        status: "implemented"
      SI-3:  # Malicious Code Protection
        name: "Malicious Code Protection"
        implementation: "Input validation, content scanning"
        status: "implemented"
      SI-4:  # System Monitoring
        name: "System Monitoring"
        implementation: "Real-time monitoring and alerting"
        status: "implemented"
      SI-7:  # Software and Information Integrity
        name: "Software, Firmware, and Information Integrity"
        implementation: "Container image signing, SBOM"
        status: "implemented"
